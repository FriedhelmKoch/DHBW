<!--
 * ============================================================================
 * Geokoordinaten - v1.0.0
 * ============================================================================
 * 
 * LIZENZINFORMATIONEN:
 * 
 * Copyright (c) 2025 by Friedhelm Koch
 * 
 * Dieses Werk ist lizenziert unter einer 
 * Creative Commons Namensnennung - Nicht kommerziell - Weitergabe unter 
 * gleichen Bedingungen 4.0 International Lizenz.
 * 
 * Vollständiger Lizenztext: https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.de
 * Mensch-lesbare Zusammenfassung: https://creativecommons.org/licenses/by-nc-sa/4.0/deed.de
 * 
 * ============================================================================
 * 
 * Bedingungen der CC BY-NC-SA 4.0 Lizenz:
 * 
 * - NAMENSNENNUNG — Sie müssen angemessene Urheber- und Rechteangaben machen
 * - NICHT KOMMERZIELL — Sie dürfen das Material nicht für kommerzielle Zwecke nutzen
 * - WEITERGABE UNTER GLEICHEN BEDINGUNGEN — Wenn Sie das Material remixen, verändern
 *   oder darauf aufbauen, müssen Sie Ihre Beiträge unter der gleichen Lizenz
 *   wie das Original verbreiten
 * 
 * ============================================================================
 *
 -->

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geokoordinaten - Erweiterte Standortbestimmung</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #27ae60;
            --warning-color: #e67e22;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }

        header h1 {
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        header p {
            opacity: 0.8;
            font-size: 0.9rem;
        }

        .content {
            padding: 20px;
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card h2 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card h2 i {
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #1a252f;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #219955;
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #d35400;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .coordinates-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .coordinate-item {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
        }

        .coordinate-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .coordinate-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .gps-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .gps-detail-item {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: var(--border-radius);
            text-align: center;
        }

        .gps-detail-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .gps-detail-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .coordinate-formats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .format-group {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
        }

        .format-group h3 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--secondary-color);
            text-align: center;
        }

        .format-value {
            font-family: monospace;
            background-color: white;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            text-align: center;
            font-size: 0.9rem;
        }

        #map {
            height: 300px;
            width: 100%;
            border-radius: var(--border-radius);
            margin-top: 10px;
        }

        .address-result {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            min-height: 60px;
        }

        .api-info {
            background-color: #2c3e50;
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            margin-top: 15px;
            font-family: monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }

        .api-info h3 {
            margin-bottom: 10px;
            color: #ecf0f1;
        }

        .json-key {
            color: #3498db;
        }

        .json-string {
            color: #2ecc71;
        }

        .json-number {
            color: #e74c3c;
        }

        .json-boolean {
            color: #f39c12;
        }

        .status-message {
            padding: 10px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            display: none;
        }

        .status-success {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success-color);
            border-left: 4px solid var(--success-color);
        }

        .status-error {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger-color);
            border-left: 4px solid var(--danger-color);
        }

        .status-info {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
        }

        .icon {
            width: 20px;
            height: 20px;
        }

        footer {
            text-align: center;
            padding: 15px;
            background-color: var(--light-color);
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
        }

        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 600px) {
            .coordinates-display,
            .coordinate-formats {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .gps-details {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Geokoordinaten - Erweiterte Standortbestimmung</h1>
            <p>Ermitteln Sie Ihre aktuellen Koordinaten oder suchen Sie nach einer Adresse mit erweiterten GPS-Informationen</p>
        </header>

        <div class="content">
            <div class="card">
                <h2>
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                    Aktuelle Position ermitteln
                </h2>
                <p>Klicken Sie auf die Schaltfläche, um Ihre aktuelle Position zu ermitteln. Die Koordinaten werden automatisch ausgefüllt und auf der Karte angezeigt.</p>
                
                <div class="form-group">
                    <button id="getLocation" class="btn-primary">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                        </svg>
                        Aktuelle Position abrufen
                    </button>
                </div>
                
                <div id="locationStatus" class="status-message"></div>
                
                <div class="coordinates-display">
                    <div class="coordinate-item">
                        <div class="coordinate-label">Breitengrad (Dezimalgrad)</div>
                        <div id="latitudeValue" class="coordinate-value">-</div>
                    </div>
                    <div class="coordinate-item">
                        <div class="coordinate-label">Längengrad (Dezimalgrad)</div>
                        <div id="longitudeValue" class="coordinate-value">-</div>
                    </div>
                </div>
                
                <div class="coordinate-formats">
                    <div class="format-group">
                        <h3>Breitengrad (Grad, Dezimalminuten)</h3>
                        <div id="latitudeDMS" class="format-value">-</div>
                    </div>
                    <div class="format-group">
                        <h3>Längengrad (Grad, Dezimalminuten)</h3>
                        <div id="longitudeDMS" class="format-value">-</div>
                    </div>
                </div>
                
                <div class="gps-details">
                    <div class="gps-detail-item">
                        <div class="gps-detail-label">Genauigkeit</div>
                        <div id="accuracyValue" class="gps-detail-value">-</div>
                    </div>
                    <div class="gps-detail-item">
                        <div class="gps-detail-label">Höhe</div>
                        <div id="altitudeValue" class="gps-detail-value">-</div>
                    </div>
                    <div class="gps-detail-item">
                        <div class="gps-detail-label">Höhengenauigkeit</div>
                        <div id="altitudeAccuracyValue" class="gps-detail-value">-</div>
                    </div>
                    <div class="gps-detail-item">
                        <div class="gps-detail-label">Richtung</div>
                        <div id="headingValue" class="gps-detail-value">-</div>
                    </div>
                    <div class="gps-detail-item">
                        <div class="gps-detail-label">Geschwindigkeit</div>
                        <div id="speedValue" class="gps-detail-value">-</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zM7 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9z"/>
                        <circle cx="12" cy="9" r="2.5"/>
                    </svg>
                    Koordinaten eingeben
                </h2>
                <p>Geben Sie manuell Koordinaten ein, um diese auf der Karte anzuzeigen oder umgekehrt eine Adresse zu ermitteln.</p>
                
                <div class="form-group">
                    <label for="latitude">Breitengrad (Dezimalgrad)</label>
                    <input type="number" id="latitude" step="any" placeholder="z.B. 48.7758">
                </div>
                
                <div class="form-group">
                    <label for="longitude">Längengrad (Dezimalgrad)</label>
                    <input type="number" id="longitude" step="any" placeholder="z.B. 9.1829">
                </div>
                
                <div class="button-group">
                    <button id="showOnMap" class="btn-secondary">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"/>
                        </svg>
                        Auf Karte anzeigen
                    </button>
                    <button id="getAddress" class="btn-warning">
                        <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                        Adresse ermitteln
                    </button>
                </div>
                
                <div id="addressStatus" class="status-message"></div>
                
                <div class="form-group">
                    <label>Adresse</label>
                    <div id="addressResult" class="address-result">
                        Geben Sie Koordinaten ein und klicken Sie auf "Adresse ermitteln"
                    </div>
                </div>
                
                <div class="tabs">
                    <div class="tab active" data-tab="api-info">API-Informationen</div>
                    <div class="tab" data-tab="json-response">JSON-Antwort</div>
                </div>
                
                <div class="tab-content active" id="api-info">
                    <div class="api-info">
                        <h3>Nominatim API-Aufruf</h3>
                        <div id="apiCallInfo">Noch keine API-Anfrage durchgeführt</div>
                    </div>
                </div>
                
                <div class="tab-content" id="json-response">
                    <div class="api-info">
                        <h3>JSON-Antwort von Nominatim</h3>
                        <pre id="jsonResponse">Noch keine Antwort empfangen</pre>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 2c2.76 0 5 2.24 5 5 0 2.88-2.88 7.19-5 9.88C9.92 16.21 7 11.85 7 9c0-2.76 2.24-5 5-5zm0 2.5c-1.38 0-2.5 1.12-2.5 2.5s1.12 2.5 2.5 2.5 2.5-1.12 2.5-2.5-1.12-2.5-2.5-2.5z"/>
                    </svg>
                    Kartenansicht
                </h2>
                <p>Die Position wird auf der OpenStreetMap-Karte angezeigt. Sie können auf die Karte klicken, um einen Marker zu setzen.</p>
                <div id="map"></div>
            </div>
        </div>

        <footer style="padding: 15px; text-align: center; font-size: 0.85em;">
            <p class="footer-text">
                <span style="vertical-align: middle;">
                    Geokoordinaten Webanwendung | Unter Verwendung von OpenStreetMap, Nominatim und Leaflet<br />
                    Copyright © <script>document.write(new Date().getFullYear())</script> 
                    Friedhelm Koch | Lizenz: 
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" 
                    target="_blank" style="color: #06c;">CC BY-NC-SA 4.0</a>
                </span>
            </p>
        </footer>

    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialisierung der Karte
        // Erstellt eine OpenStreetMap-Karte mit einem Standard-Zoomlevel und Zentrierung
        let map = L.map('map').setView([48.7758, 9.1829], 13); // Stuttgart als Startpunkt
        let marker = null; // Variable für den Marker auf der Karte
        
        // OpenStreetMap-Tile-Layer hinzufügen
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Kartenklick-Event: Setzt einen Marker an die angeklickte Position
        map.on('click', function(e) {
            // Wenn bereits ein Marker existiert, entfernen wir ihn
            if (marker) {
                map.removeLayer(marker);
            }
            
            // Neuen Marker an der geklickten Position setzen
            marker = L.marker(e.latlng).addTo(map);
            
            // Koordinaten in die Eingabefelder schreiben
            document.getElementById('latitude').value = e.latlng.lat.toFixed(6);
            document.getElementById('longitude').value = e.latlng.lng.toFixed(6);
            
            // Koordinaten-Anzeige aktualisieren
            updateCoordinateDisplay(e.latlng.lat, e.latlng.lng);
            
            // Statusmeldung anzeigen
            showStatus('locationStatus', 'Neue Position auf der Karte gesetzt', 'success');
        });
        
        // Funktion zum Anzeigen von Statusmeldungen
        function showStatus(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = 'status-message';
            
            switch(type) {
                case 'success':
                    statusElement.classList.add('status-success');
                    break;
                case 'error':
                    statusElement.classList.add('status-error');
                    break;
                case 'info':
                    statusElement.classList.add('status-info');
                    break;
            }
            
            statusElement.style.display = 'block';
            
            // Nach 5 Sekunden ausblenden
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 5000);
        }
        
        // Funktion zur Umwandlung von Dezimalgrad in Grad und Dezimalminuten
        function decimalToDMS(decimal, isLatitude) {
            const direction = isLatitude ? 
                (decimal >= 0 ? 'N' : 'S') : 
                (decimal >= 0 ? 'E' : 'W');
            
            const absDecimal = Math.abs(decimal);
            const degrees = Math.floor(absDecimal);
            const minutes = (absDecimal - degrees) * 60;
            
            return `${degrees}° ${minutes.toFixed(4)}' ${direction}`;
        }
        
        // Funktion zur Aktualisierung der Koordinaten-Anzeige
        function updateCoordinateDisplay(lat, lng) {
            // Dezimalgrad anzeigen
            document.getElementById('latitudeValue').textContent = lat.toFixed(6);
            document.getElementById('longitudeValue').textContent = lng.toFixed(6);
            
            // Grad und Dezimalminuten anzeigen
            document.getElementById('latitudeDMS').textContent = decimalToDMS(lat, true);
            document.getElementById('longitudeDMS').textContent = decimalToDMS(lng, false);
        }
        
        // Funktion zur Aktualisierung der GPS-Details
        function updateGPSDetails(position) {
            const coords = position.coords;
            
            // Genauigkeit anzeigen (in Metern)
            document.getElementById('accuracyValue').textContent = 
                coords.accuracy ? `${coords.accuracy.toFixed(1)} m` : '-';
            
            // Höhe anzeigen (in Metern über Meeresspiegel)
            document.getElementById('altitudeValue').textContent = 
                coords.altitude ? `${coords.altitude.toFixed(1)} m` : '-';
            
            // Höhengenauigkeit anzeigen (in Metern)
            document.getElementById('altitudeAccuracyValue').textContent = 
                coords.altitudeAccuracy ? `${coords.altitudeAccuracy.toFixed(1)} m` : '-';
            
            // Richtung anzeigen (in Grad von Norden)
            document.getElementById('headingValue').textContent = 
                coords.heading ? `${coords.heading.toFixed(1)}°` : '-';
            
            // Geschwindigkeit anzeigen (in m/s)
            document.getElementById('speedValue').textContent = 
                coords.speed ? `${coords.speed.toFixed(1)} m/s` : '-';
        }
        
        // Funktion zur Formatierung von JSON mit Syntax-Highlighting
        function syntaxHighlight(json) {
            if (!json) return 'No data available';
            
            // Einfache JSON-Formatierung mit Farben
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }
        
        // Tab-Funktionalität
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Aktiven Tab entfernen
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Neuen aktiven Tab setzen
                this.classList.add('active');
                document.getElementById(this.dataset.tab).classList.add('active');
            });
        });
        
        // Aktuelle Position ermitteln
        document.getElementById('getLocation').addEventListener('click', function() {
            // Prüfen, ob der Browser die Geolocation-API unterstützt
            if (!navigator.geolocation) {
                showStatus('locationStatus', 'Ihr Browser unterstützt die Standortermittlung nicht.', 'error');
                return;
            }
            
            // Statusmeldung anzeigen
            showStatus('locationStatus', 'Ermittle Ihre Position...', 'info');
            
            // Geolocation-API aufrufen
            navigator.geolocation.getCurrentPosition(
                // Erfolgsfall
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    
                    // Koordinaten in die Eingabefelder schreiben
                    document.getElementById('latitude').value = lat;
                    document.getElementById('longitude').value = lng;
                    
                    // Koordinaten-Anzeige aktualisieren
                    updateCoordinateDisplay(lat, lng);
                    
                    // GPS-Details aktualisieren
                    updateGPSDetails(position);
                    
                    // Alten Marker entfernen, falls vorhanden
                    if (marker) {
                        map.removeLayer(marker);
                    }
                    
                    // Neuen Marker setzen und Karte zentrieren
                    marker = L.marker([lat, lng]).addTo(map);
                    map.setView([lat, lng], 15);
                    
                    // Erfolgsmeldung anzeigen
                    showStatus('locationStatus', 'Position erfolgreich ermittelt!', 'success');
                },
                // Fehlerfall
                function(error) {
                    let errorMessage = 'Fehler bei der Standortermittlung: ';
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'Zugriff auf Standort verweigert.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'Standortinformation nicht verfügbar.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'Zeitüberschreitung bei der Standoranfrage.';
                            break;
                        default:
                            errorMessage += 'Unbekannter Fehler.';
                    }
                    
                    showStatus('locationStatus', errorMessage, 'error');
                },
                // Optionen für die Geolocation
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000
                }
            );
        });
        
        // Koordinaten auf der Karte anzeigen
        document.getElementById('showOnMap').addEventListener('click', function() {
            const lat = parseFloat(document.getElementById('latitude').value);
            const lng = parseFloat(document.getElementById('longitude').value);
            
            // Validierung der Eingaben
            if (isNaN(lat) || isNaN(lng)) {
                showStatus('addressStatus', 'Bitte geben Sie gültige Koordinaten ein.', 'error');
                return;
            }
            
            if (lat < -90 || lat > 90) {
                showStatus('addressStatus', 'Breitengrad muss zwischen -90 und 90 liegen.', 'error');
                return;
            }
            
            if (lng < -180 || lng > 180) {
                showStatus('addressStatus', 'Längengrad muss zwischen -180 und 180 liegen.', 'error');
                return;
            }
            
            // Alten Marker entfernen, falls vorhanden
            if (marker) {
                map.removeLayer(marker);
            }
            
            // Neuen Marker setzen und Karte zentrieren
            marker = L.marker([lat, lng]).addTo(map);
            map.setView([lat, lng], 15);
            
            // Koordinaten-Anzeige aktualisieren
            updateCoordinateDisplay(lat, lng);
            
            // Erfolgsmeldung anzeigen
            showStatus('addressStatus', 'Koordinaten erfolgreich auf der Karte angezeigt.', 'success');
        });
        
        // Adresse zu Koordinaten ermitteln (Reverse Geocoding)
        document.getElementById('getAddress').addEventListener('click', function() {
            const lat = parseFloat(document.getElementById('latitude').value);
            const lng = parseFloat(document.getElementById('longitude').value);
            
            // Validierung der Eingaben
            if (isNaN(lat) || isNaN(lng)) {
                showStatus('addressStatus', 'Bitte geben Sie gültige Koordinaten ein.', 'error');
                return;
            }
            
            // Statusmeldung anzeigen
            showStatus('addressStatus', 'Ermittle Adresse...', 'info');
            
            // API-URL für Nominatim erstellen
            const apiUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`;
            
            // API-Aufruf-Informationen anzeigen
            document.getElementById('apiCallInfo').textContent = `GET ${apiUrl}`;
            
            // Nominatim API für Reverse Geocoding aufrufen
            // Nominatim ist der OpenStreetMap-Geocoding-Dienst
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Netzwerkfehler bei der Adressabfrage');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // Adresse aus den Daten extrahieren
                    const address = data.display_name || 'Adresse nicht gefunden';
                    document.getElementById('addressResult').textContent = address;
                    
                    // JSON-Antwort anzeigen
                    document.getElementById('jsonResponse').innerHTML = syntaxHighlight(JSON.stringify(data, null, 2));
                    
                    // Erfolgsmeldung anzeigen
                    showStatus('addressStatus', 'Adresse erfolgreich ermittelt!', 'success');
                })
                .catch(error => {
                    console.error('Fehler bei der Adressermittlung:', error);
                    document.getElementById('addressResult').textContent = 'Fehler bei der Adressermittlung: ' + error.message;
                    showStatus('addressStatus', 'Fehler bei der Adressermittlung.', 'error');
                });
        });
    </script>
</body>
</html>
