<!--
 * ============================================================================
 * Lottozahlen KI - v1.0.0
 * ============================================================================
 * 
 * LIZENZINFORMATIONEN:
 * 
 * Copyright (c) 2025 by Friedhelm Koch
 * 
 * Dieses Werk ist lizenziert unter einer 
 * Creative Commons Namensnennung - Nicht kommerziell - Weitergabe unter 
 * gleichen Bedingungen 4.0 International Lizenz.
 * 
 * Vollst√§ndiger Lizenztext: https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.de
 * Mensch-lesbare Zusammenfassung: https://creativecommons.org/licenses/by-nc-sa/4.0/deed.de
 * 
 * Historische Daten von: 
 * for (let jahr = 1992; jahr <= 2026; jahr++) {
 *   https://www.lottozahlenonline.de/statistik/beide-spieltage/lottozahlen-archiv.php?j=${jahr}#lottozahlen-archiv
 *}
 * ============================================================================
 * 
 * Bedingungen der CC BY-NC-SA 4.0 Lizenz:
 * 
 * - NAMENSNENNUNG ‚Äî Sie m√ºssen angemessene Urheber- und Rechteangaben machen
 * - NICHT KOMMERZIELL ‚Äî Sie d√ºrfen das Material nicht f√ºr kommerzielle Zwecke nutzen
 * - WEITERGABE UNTER GLEICHEN BEDINGUNGEN ‚Äî Wenn Sie das Material remixen, ver√§ndern
 *   oder darauf aufbauen, m√ºssen Sie Ihre Beitr√§ge unter der gleichen Lizenz
 *   wie das Original verbreiten
 * 
 * ============================================================================
 *
 -->
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lotto KI - Historische Daten ab 1992</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.20.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #f0f2f5; padding: 20px; max-width: 800px; margin: 0 auto; }
        
        .header { 
            background: linear-gradient(135deg, #61a8ff 0%, #838383 100%);
            text-align: center; 
            padding: 25px; 
            border-radius: 15px; 
            margin-bottom: 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .data-warning {
            font-size: 90%;
            background: linear-gradient(135deg, #e9f6c8 0%, #dfffa9 100%);
            border: 2px solid #ff3c00;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }
        
        /* KLARE LISTEN-DARSTELLUNG */
        .steps-list {
            margin: 25px 0;
            padding: 0;
            list-style: none;
        }
        
        .step-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
            transition: all 0.3s;
        }
        
        .step-item.completed {
            background: #e8f5e9;
            border-left-color: #4CAF50;
        }
        
        .step-item.active {
            background: #e3f2fd;
            border-left-color: #2196F3;
            box-shadow: 0 3px 10px rgba(33, 150, 243, 0.2);
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: #2196F3;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            margin-right: 20px;
            flex-shrink: 0;
        }
        
        .step-item.completed .step-number {
            background: #4CAF50;
        }
        
        .step-item.active .step-number {
            background: #2196F3;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-actions {
            margin-top: 15px;
        }
        
        .btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(33, 150, 243, 0.3);
        }
        
        .btn:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #FF9800, #EF6C00);
        }
        
        .btn-loading {
            position: relative;
            overflow: hidden;
        }
        
        .btn-loading:after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* TRAINING FORTSCHRITT */
        .training-progress {
            margin-top: 20px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 10px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .progress-bar {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            font-size: 12px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }
        
        .epoch-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .epoch-stat {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .epoch-value {
            font-size: 22px;
            font-weight: bold;
            color: #2196F3;
            margin: 5px 0;
        }
        
        /* HISTORISCHE DATEN INFO */
        .historical-data-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .data-stat {
            text-align: center;
        }
        
        .data-value {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
            margin: 5px 0;
        }
        
        /* ERGEBNISSE */
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .result-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            border-top: 4px solid #2196F3;
        }
        
        .numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
            justify-content: center;
        }
        
        .number {
            width: 40px;
            height: 40px;
            background: #2196F3;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
        }
        
        .super-number {
            background: #FF5722;
            width: 44px;
            height: 44px;
            font-size: 18px;
        }
        
        .chart-container {
            height: 300px;
            margin: 20px 0;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }
        
        @media (max-width: 640px) {
            .step-item {
                flex-direction: column;
            }
            
            .step-number {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .epoch-info {
                grid-template-columns: 1fr 1fr;
            }
            
            .results {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Ihr komplettes UI bleibt GENAU gleich -->
    <div class="header">
        <h1>üé≤ Lottozahlen KI</h1>
        <p>Mit einer Analyse historischer Daten ab 1992</p>
    </div>

    <div class="data-warning">
        <strong>üìÖ Wichtig:</strong> Diese Web-App verwendet <strong>komplette historische Daten ab 1992 </strong> 
        (<span id="totalDrawsCount">√ºber 3.094</span> Ziehungen). Das Training dauert entsprechend l√§nger - bitte haben Sie Geduld!<br />
        <p>Die Dauer das Modell zu trainieren ist stark davon abh√§nging, ob eine <strong>NPU</strong> (Neural Processing Unit) im ausf√ºhrenden Device vorhanden ist. Diese ist in der Lage komplexe Matrizenoperationen effizienter durchzuf√ºhren als herk√∂mmliche CPU-Prozessoren.</p><br />
        <p>Selbst wenn die ¬ªKI-LSTM Vorhersage¬´ eine "hohe Konfidenz" von z.B. 85% anzeigt, bedeutet das <strong>nicht</strong>,
        dass die Vorhersage zu 85% richtig liegt. Es bedeutet nur, dass das Modell <em>selbst sehr sicher ist</em> ‚Äì
        ein klassisches Beispiel f√ºr ¬ªOverconfidence bei Overfitting¬´!</p><br />
        <p>Das <strong>KI LSTM-Modell</strong> (Long Short-Term Memory) ist eine spezielle Art von k√ºnstlichem neuronalem Netz, das im ¬ªDeep Learning¬´ eingesetzt wird, um Muster in sequenziellen Daten oder Zeitreihen zu erkennen und vorherzusagen. 
        Im Gegensatz zu herk√∂mmlichen neuronalen Netzen besitzt es ein ¬ªGed√§chtnis¬´, wodurch es Informationen √ºber l√§ngere Zeitr√§ume speichern, aktualisieren und abrufen kann.</p>
        Dieses KI-Modell arbeitet <strong>probabilistisch</strong>, um komplexe Muster zu erkennen und Vorhersagen zu treffen. Ein ¬ªstatistisches Wahrscheinlichkeitsmodell¬´ arbeitet eher <strong>deduktiv</strong> und versucht Zusammenh√§nge in Daten zu verstehen und zu erkl√§ren.<br />
    </div>

    <div class="container">
        <h2>üìã Schritt-f√ºr-Schritt Vorgehen</h2>
        <ol style="padding-left: 30px;">
            <li>Bitte f√ºhren Sie die Schritte <strong>in der angegebenen Reihenfolge</strong> durch:</li>
            <li>Nach Schritt 4 finden Sie die Vorhersage der Lottozahlen inkl der Zusazzahl in ¬ªErgebnisse der KI-Analyse¬´ weiter unten.</li>
        </ol>
        
        <ul class="steps-list">
            <!-- SCHRITT 1: DATEN LADEN -->
            <li class="step-item active" id="step1">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h3>Historische Daten laden (ab 1992)</h3>
                    <p>L√§dt alle Lottoziehungen seit Beginn 1992 inklusive Superzahlen.</p>
                    <div class="step-actions">
                        <button class="btn" onclick="startDataLoading()" id="loadBtn">
                            üìä Historische Daten ab 1992 laden
                        </button>
                        <div id="status" style="margin-top: 10px; color: #666; font-size: 14px;"></div>
                        <div style="width: 100%; height: 6px; background: #e0e0e0; border-radius: 3px; margin-top: 10px; overflow: hidden;">
                            <div id="progress" style="height: 100%; background: #2196F3; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <div id="details" style="font-size: 12px; color: #888; margin-top: 5px;"></div>
                    </div>
                </div>
            </li>
            
            <!-- SCHRITT 2: MODELL ERSTELLEN -->
            <li class="step-item" id="step2">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h3>LSTM KI-Modell erstellen</h3>
                    <p>Baut die TensorFlow.js LSTM-Architektur f√ºr die Analyse.</p>
                    <div class="step-actions">
                        <button class="btn" id="buildBtn" onclick="buildModel()" disabled>
                            üî® LSTM Modell f√ºr historische Daten erstellen
                        </button>
                    </div>
                </div>
            </li>
            
            <!-- SCHRITT 3: TRAINING -->
            <li class="step-item" id="step3">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h3>Modell mit allen Daten trainieren</h3>
                    <p>Trainiert die KI mit allen historischen Daten (30 Epochen).</p>
                    <div class="step-actions">
                        <button class="btn btn-success" id="trainBtn" onclick="startTraining()" disabled>
                            üéØ Training mit allen Daten starten
                        </button>
                    </div>
                    
                    <!-- TRAINING FORTSCHRITT -->
                    <div class="training-progress" id="trainingProgress" style="display: none;">
                        <div class="progress-header">
                            <span>üéØ KI-Training l√§uft (bitte warten)...</span>
                            <span id="progressPercent">0%</span>
                        </div>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" id="trainingProgressBar">
                                <div class="progress-text" id="progressText">0%</div>
                            </div>
                        </div>
                        
                        <div class="epoch-info">
                            <div class="epoch-stat">
                                <div>Aktuelle Epoche</div>
                                <div class="epoch-value" id="currentEpoch">0</div>
                                <small>von 30 total</small>
                            </div>
                            
                            <div class="epoch-stat">
                                <div>Verbleibende Zeit</div>
                                <div class="epoch-value" id="remainingTime">-</div>
                                <small>gesch√§tzt</small>
                            </div>
                            
                            <div class="epoch-stat">
                                <div>Training Loss</div>
                                <div class="epoch-value" id="currentLoss">-</div>
                                <small>aktueller Wert</small>
                            </div>
                            
                            <div class="epoch-stat">
                                <div>Fortschritt</div>
                                <div class="epoch-value" id="completedPercent">0%</div>
                                <small>abgeschlossen</small>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            
            <!-- SCHRITT 4: VORHERSAGE -->
            <li class="step-item" id="step4">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h3>Vorhersage generieren</h3>
                    <p>Erstellt eine Vorhersage basierend auf dem trainierten Modell.</p>
                    <div class="step-actions">
                        <button class="btn btn-warning" id="predictBtn" onclick="makePrediction()" disabled>
                            üîÆ Vorhersage mit KI-Modell generieren
                        </button>
                    </div>
                </div>
            </li>
        </ul>
    </div>

    <!-- HISTORISCHE DATEN INFO -->
    <div class="container" id="dataInfo" style="display: none;">
        <h2>üìä Historische Daten√ºbersicht</h2>
        
        <div class="historical-data-info">
            <div class="data-stat">
                <div>Zeitraum</div>
                <div class="data-value" id="dataYears">-</div>
                <small>Jahre</small>
            </div>
            
            <div class="data-stat">
                <div>Ziehungen</div>
                <div class="data-value" id="dataDraws">-</div>
                <small>Gesamt</small>
            </div>
            
            <div class="data-stat">
                <div>H√§ufigste Zahl</div>
                <div class="data-value" id="mostFrequent">-</div>
                <small>historisch</small>
            </div>
            
            <div class="data-stat">
                <div>H√§ufigste Superzahl</div>
                <div class="data-value" id="mostSuper">-</div>
                <small>0-9</small>
            </div>
        </div>
        
        <div class="chart-container">
            <canvas id="dataChart"></canvas>
        </div>
    </div>

    <!-- ERGEBNISSE -->
    <div class="container">
        <h2>üéØ Ergebnisse der KI-Analyse</h2>
        
        <div class="results">
            <div class="result-card">
                <h3>KI LSTM Lottozahlen Vorhersage</h3>
                <div class="numbers" id="predictionNumbers">
                    <div class="number">?</div><div class="number">?</div><div class="number">?</div>
                    <div class="number">?</div><div class="number">?</div><div class="number">?</div>
                    <div class="number super-number">?</div>
                </div>
                <div id="predictionDetails" style="font-size: 90%; text-align: center; margin-top: 15px;">
                    <em>Bitte zuerst alle 4 Schritte durchf√ºhren</em>
                </div>
                <div id="modelInfo" style="font-size: 12px; color: #666; margin-top: 15px;">
                    <strong>Modell-Status:</strong> Nicht trainiert<br>
                    <strong>Trainingsdaten:</strong> 0 Ziehungen
                </div>
            </div>
            
            <div class="result-card">
                <h3>Statistische Fakten</h3>
                <div id="statsInfo" style="font-size: 90%;">
                    <!-- Diese IDs werden dynamisch bef√ºllt -->
                    <p><strong>üìÖ Historischer Zeitraum:</strong> <span id="statsTimeframe">1992-2026</span></p>
                    <p><strong>üé≤ Datens√§tze in DB:</strong> <span id="statsRecordCount">3.094</span> Ziehungen</p>
                    <p><strong>üìä Datenstand vom:</strong> <span id="statsDataDate">-</span></p>
                    <p><strong>üé≤ Grundwahrscheinlichkeit:</strong> 1:139.838.160</p>
                    <p><strong>üß† KI-Architektur:</strong> LSTM mit 32 Memory-Zellen</p>
                    <p><strong>üìä Trainingsdauer:</strong> ~30 Epochen (je nach CPU/NPU, 30 Sek. bis zu 2 Min.)</p>
                    <p><strong>‚ö†Ô∏è Wichtig:</strong> KI findet nur statistisches Rauschen, keine echten Muster!</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer" style="padding: 15px; text-align: center; font-size: 0.85em;">
            <p class="footer-text">
                <span style="vertical-align: middle;">
                    Lotto KI | mittels TensorFlow | Historische Daten:<br />
                    www.lottozahlenonline.de/statistik/beide-spieltage/lottozahlen-archiv<br />
                    Copyright ¬© <script>document.write(new Date().getFullYear())</script> 
                    Friedhelm Koch | Lizenz: 
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" 
                    target="_blank" style="color: rgb(109, 182, 255);">CC BY-NC-SA 4.0</a>
                </span>
            </p>
        </footer>
        
        <!-- DATENSTATISTIK ERG√ÑNZUNG -->
        <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 10px; border-left: 4px solid #4CAF50;">
            <h4 style="color: #2E7D32; margin-bottom: 10px;">üìÇ Historische Lotto-Daten (JSON-Datenbank Status)</h4>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px;">
                <div style="text-align: center;">
                    <div style="font-size: 12px; color: #666;">JSON-Datens√§tze</div>
                    <div id="jsonRecordCount" style="font-size: 28px; font-weight: bold; color: #2E7D32;">?</div>
                    <small>Gespeicherte Ziehungen</small>
                </div>
                
                <div style="text-align: center;">
                    <div style="font-size: 12px; color: #666;">JSON-Dateigr√∂√üe</div>
                    <div id="jsonFileSize" style="font-size: 28px; font-weight: bold; color: #2E7D32;">?</div>
                    <small>Ungef√§hre Gr√∂√üe</small>
                </div>
                
                <div style="text-align: center;">
                    <div style="font-size: 12px; color: #666;">Datenstand</div>
                    <div id="jsonLastUpdate" style="font-size: 20px; font-weight: bold; color: #2E7D32;">-</div>
                    <small>Letzte Aktualisierung</small>
                </div>
            </div>
            
            <div id="jsonLoadingStatus" style="font-size: 13px; color: #666; text-align: center;">
                <em>JSON-Daten werden analysiert...</em>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="trainingChart"></canvas>
        </div>
    </div>

    <script>
        // ============================================
        // ALLE NOTWENDIGEN FUNKTIONEN HIER DEFINIEREN
        // ============================================
        
        // GLOBALE VARIABLEN
        let historicalData = [];
        let tfModel = null;
        let dataChart = null;
        let trainingChart = null;
        let isTraining = false;
        let trainingStartTime = null;
        
        // ============================================
        // 1. HILFSFUNKTIONEN F√úR DIE UI
        // ============================================
        
        function updateStep(stepId, status) {
            const step = document.getElementById(stepId);
            step.classList.remove('active', 'completed');
            
            if (status === 'active') {
                step.classList.add('active');
            } else if (status === 'completed') {
                step.classList.add('completed');
            }
        }
        
        function updateButton(buttonId, enabled, text = null, loading = false) {
            const button = document.getElementById(buttonId);
            button.disabled = !enabled;
            
            if (text) {
                button.innerHTML = text;
            }
            
            if (loading) {
                button.classList.add('btn-loading');
            } else {
                button.classList.remove('btn-loading');
            }
        }
        
        function showElement(elementId, show) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.display = show ? 'block' : 'none';
            }
        }
        
        function createStatusElements() {
            const stepActions = document.getElementById('step1').querySelector('.step-actions');
            
            // Status Text
            let status = document.getElementById('status');
            if (!status) {
                status = document.createElement('div');
                status.id = 'status';
                status.style.marginTop = '10px';
                status.style.color = '#666';
                status.style.fontSize = '14px';
                stepActions.appendChild(status);
            }
            
            // Progress Bar
            let progressContainer = document.querySelector('#step1 .progress-container');
            if (!progressContainer) {
                progressContainer = document.createElement('div');
                progressContainer.style.width = '100%';
                progressContainer.style.height = '6px';
                progressContainer.style.background = '#e0e0e0';
                progressContainer.style.borderRadius = '3px';
                progressContainer.style.marginTop = '10px';
                progressContainer.style.overflow = 'hidden';
                
                const progressBar = document.createElement('div');
                progressBar.id = 'progress';
                progressBar.style.height = '100%';
                progressBar.style.background = '#2196F3';
                progressBar.style.width = '0%';
                progressBar.style.transition = 'width 0.3s';
                
                progressContainer.appendChild(progressBar);
                stepActions.appendChild(progressContainer);
            }
            
            // Details Text
            let details = document.getElementById('details');
            if (!details) {
                details = document.createElement('div');
                details.id = 'details';
                details.style.fontSize = '12px';
                details.style.color = '#888';
                details.style.marginTop = '5px';
                stepActions.appendChild(details);
            }
            
            return { status, progress: document.getElementById('progress'), details };
        }
        
        // ============================================
        // 2. DATEN LADEN (SCHRITT 1)
        // ============================================

        async function startDataLoading() {
            updateStep('step1', 'active');
            updateButton('loadBtn', false, '‚è≥ Lade historische Daten...', true);
            
            const { status, progress, details } = createStatusElements();
            
            try {
                status.textContent = 'Starte Datenabruf...';
                progress.style.width = '10%';
                details.textContent = 'Initialisiere...';
                
                // F√ºhre zuerst die JSON-Analyse durch
                const jsonStats = await analyzeJSONData();
                progress.style.width = '30%';
                
                // Lade echte oder simulierte Daten
                historicalData = await loadLottoData();
                
                if (historicalData.length === 0) {
                    throw new Error('Keine Daten geladen');
                }
                
                // Aktualisiere Anzeige mit den geladenen Daten
                updateTotalDrawsCount(historicalData.length);
                
                // *** NEU: Aktualisiere Statistische Fakten mit historischen Daten ***
                const years = historicalData.map(d => d.year).filter(y => y);
                const firstYear = years.length > 0 ? Math.min(...years) : 1992;
                const lastYear = years.length > 0 ? Math.max(...years) : 2026;
                const lastDraw = historicalData[historicalData.length - 1];
                const lastDate = lastDraw && lastDraw.date ? formatGermanDate(new Date(lastDraw.date)) : '-';
                
                updateStatsFacts({
                    totalRecords: historicalData.length,
                    firstDate: formatGermanDate(new Date(historicalData[0].date)),
                    lastDate: lastDate
                });
                
                progress.style.width = '90%';
                details.textContent = `‚úÖ ${historicalData.length} Ziehungen geladen`;
                
                // Schritt abschlie√üen
                updateStep('step1', 'completed');
                updateStep('step2', 'active');
                updateButton('loadBtn', false, `‚úÖ ${historicalData.length} Ziehungen geladen`);
                updateButton('buildBtn', true);
                
                // Historische Daten anzeigen
                displayHistoricalDataInfo();
                showElement('dataInfo', true);
                
                status.textContent = 'Daten erfolgreich geladen!';
                progress.style.width = '100%';
                
                // JSON-Statistiken im Modell-Info aktualisieren
                updateModelInfoWithJSONStats(jsonStats);
                
                console.log(`‚úÖ ${historicalData.length} historische Ziehungen geladen`);
                
            } catch (error) {
                console.error('Fehler beim Laden:', error);
                status.textContent = `‚ùå Fehler: ${error.message}`;
                updateButton('loadBtn', true, 'üîÑ Erneut versuchen');
            }
        }

        function updateModelInfoWithJSONStats(jsonStats) {
            const modelInfoEl = document.getElementById('modelInfo');
            
            if (!jsonStats) {
                modelInfoEl.innerHTML = `
                    <strong>Modell-Status:</strong> Bereit f√ºr Training<br>
                    <strong>Trainingsdaten:</strong> ${historicalData.length.toLocaleString()} Ziehungen<br>
                    <strong>JSON-Datenbank:</strong> Nicht verf√ºgbar
                `;
                return;
            }
            
            modelInfoEl.innerHTML = `
                <strong>Modell-Status:</strong> Bereit f√ºr Training<br>
                <strong>Trainingsdaten:</strong> ${historicalData.length.toLocaleString()} Ziehungen<br>
                <strong>JSON-Datenbank:</strong> ${jsonStats.recordCount.toLocaleString()} Datens√§tze (${jsonStats.fileSizeMB > 1 ? jsonStats.fileSizeMB + ' MB' : (jsonStats.fileSizeBytes / 1024).toFixed(1) + ' KB'})
            `;
        }
        
        async function loadLottoData() {
            try {
                // Erste Datenquelle: Versuche √∂ffentliche API/JSON
                const publicData = await loadPublicData();
                if (publicData.length > 0) {
                    return publicData;
                }
                
                // Zweite Datenquelle: Simulierte Daten (Fallback)
                return generateSimulatedData();
                
            } catch (error) {
                console.log('Lade simulierte Daten als Fallback');
                return generateSimulatedData();
            }
        }
        
        async function loadPublicData() {
            try {
                console.log('Lade lokale JSON-Daten von lottozahlen_1992-2026.json...');
                
                // Lade die lokale JSON-Datei
                const response = await fetch('lottozahlen_1992-2026.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP-Fehler: ${response.status}`);
                }
                
                const jsonData = await response.json();
                console.log('JSON erfolgreich geladen, konvertiere Daten...');
                
                // Konvertiere das JSON-Format in unser internes Format
                return convertLocalJSONData(jsonData);
                
            } catch (error) {
                console.error('Fehler beim Laden der lokalen JSON-Daten:', error);
                
                // Fallback: Versuche die Datei mit einem alternativen Pfad zu laden
                try {
                    console.log('Versuche alternativen Pfad...');
                    const fallbackResponse = await fetch('./lottozahlen_1992-2026.json');
                    if (fallbackResponse.ok) {
                        const jsonData = await fallbackResponse.json();
                        return convertLocalJSONData(jsonData);
                    }
                } catch (fallbackError) {
                    console.error('Auch alternativer Pfad fehlgeschlagen:', fallbackError);
                }
                
                return []; // R√ºckfall zu simulierten Daten
            }
        }

        // Funktion zur Konvertierung deines JSON-Formats
        function convertLocalJSONData(jsonData) {
            const converted = [];
            
            console.log(`üìÇ JSON-Datenbank: ${jsonData.length} Datens√§tze geladen`);
            
            // Zeige JSON-Statistiken in der Console f√ºr Debugging
            console.log('üìä JSON-Datenanalyse:');
            console.log('- Anzahl Datens√§tze:', jsonData.length);
            
            // Analysiere die Datenstruktur
            if (jsonData.length > 0) {
                const firstEntry = jsonData[0];
                const lastEntry = jsonData[jsonData.length - 1];
                
                console.log('- Erster Eintrag:', firstEntry);
                console.log('- Letzter Eintrag:', lastEntry);
                
                // Extrahiere alle Jahre
                const years = [...new Set(jsonData.map(d => d.jahr).filter(y => y))];
                console.log('- Enthaltene Jahre:', years.sort((a, b) => a - b));
                
                // Z√§hle Ziehungen pro Jahr
                const drawsPerYear = {};
                jsonData.forEach(entry => {
                    drawsPerYear[entry.jahr] = (drawsPerYear[entry.jahr] || 0) + 1;
                });
                console.log('- Ziehungen pro Jahr:', drawsPerYear);
            }
            
            jsonData.forEach((entry, index) => {
                try {
                    // Extrahiere das Jahr
                    let year = entry.jahr;
                    
                    // Falls jahr nicht direkt vorhanden, parse es aus dem Datum
                    if (!year && entry.datum) {
                        const dateParts = entry.datum.split('.');
                        if (dateParts.length === 3) {
                            year = parseInt(dateParts[2]);
                        }
                    }
                    
                    // Stelle sicher, dass wir ein g√ºltiges Jahr haben
                    if (!year || year < 1992 || year > new Date().getFullYear()) {
                        year = 1992 + Math.floor(index / 104); // Approximiere Jahr
                    }
                    
                    // Stelle sicher, dass die Zahlen sortiert sind
                    const sortedNumbers = entry.gewinnzahlen 
                        ? [...entry.gewinnzahlen].sort((a, b) => a - b)
                        : generateRandomNumbers();
                    
                    converted.push({
                        id: index + 1,
                        date: formatDateString(entry.datum),
                        numbers: sortedNumbers,
                        superzahl: entry.superzahl || 0,
                        year: year
                    });
                    
                } catch (error) {
                    console.warn(`Fehler beim Konvertieren von Eintrag ${index}:`, error);
                }
            });
            
            // Sortiere nach Datum (√§lteste zuerst)
            converted.sort((a, b) => {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                if (isNaN(dateA) || isNaN(dateB)) {
                    return a.id - b.id; // Fallback nach ID sortieren
                }
                return dateA - dateB;
            });
            
            console.log(`‚úÖ Erfolgreich ${converted.length} Lottoziehungen aus JSON konvertiert`);
            return converted;
        }

        // Hilfsfunktion zum Formatieren des Datums
        function formatDateString(germanDate) {
            if (!germanDate) return new Date().toISOString().split('T')[0];
            
            // Konvertiere DD.MM.YYYY zu YYYY-MM-DD
            const parts = germanDate.split('.');
            if (parts.length === 3) {
                const day = parts[0].padStart(2, '0');
                const month = parts[1].padStart(2, '0');
                const year = parts[2];
                return `${year}-${month}-${day}`;
            }
            
            return germanDate;
        }

        // Alternative Datenquelle als Fallback
        async function loadAlternativeData() {
            try {
                // OPTION 3: √ñffentliche JSON-API (falls verf√ºgbar)
                const apis = [
                    'https://api.lottozahlendienst.de/latest',
                    'https://www.lotto.de/static/generated/lottozahlen_archiv.json'
                ];
                
                for (const apiUrl of apis) {
                    try {
                        console.log(`Versuche API: ${apiUrl}`);
                        const response = await fetch(apiUrl, {
                            headers: {
                                'Accept': 'application/json'
                            }
                        });
                        
                        if (response.ok) {
                            const data = await response.json();
                            return convertApiData(data);
                        }
                    } catch (apiError) {
                        console.warn(`API ${apiUrl} nicht verf√ºgbar:`, apiError);
                        continue;
                    }
                }
                
                throw new Error('Keine alternative API verf√ºgbar');
                
            } catch (error) {
                throw error;
            }
        }

        // Konvertiere API-Daten in unser Format
        function convertApiData(apiData) {
            const converted = [];
            
            // Hier m√ºssten Sie die API-Struktur anpassen
            // Dies ist ein allgemeines Beispiel
            if (apiData.draws && Array.isArray(apiData.draws)) {
                apiData.draws.forEach((draw, index) => {
                    if (draw.numbers && draw.date) {
                        converted.push({
                            id: index + 1,
                            date: draw.date,
                            numbers: draw.numbers.slice(0, 6).sort((a, b) => a - b),
                            superzahl: draw.superNumber || draw.additionalNumber || 0,
                            year: new Date(draw.date).getFullYear()
                        });
                    }
                });
            }
            
            return converted;
        }

        // ============================================
        // INITIALISIERE DIE JSON-ANALYSE BEIM LADEN
        // ============================================

        // Initialisierung beim Seitenladen
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Lotto KI App geladen, starte Datenanalyse...');
            
            // Initialisiere mit Standardwerten
            setTimeout(() => {
                // Pr√ºfe zuerst, ob bereits Daten im localStorage sind
                const lastScrape = localStorage.getItem('lotto_last_scrape');
                if (lastScrape) {
                    try {
                        const scrapedData = localStorage.getItem('lotto_scraped_data');
                        if (scrapedData) {
                            const parsedData = JSON.parse(scrapedData);
                            if (Array.isArray(parsedData) && parsedData.length > 0) {
                                updateStatsFacts({
                                    totalRecords: parsedData.length,
                                    lastDate: new Date(lastScrape).toLocaleDateString('de-DE')
                                });
                            }
                        }
                    } catch (e) {
                        console.warn('Konnte gespeicherte Daten nicht laden:', e);
                    }
                }
                
                // Starte die JSON-Analyse
                analyzeJSONData().catch(err => {
                    console.log('JSON-Analyse im Hintergrund fehlgeschlagen:', err);
                    
                    // Fallback: Zeige zumindest Standardwerte
                    const element = document.getElementById('totalDrawsCount');
                    if (element && historicalData && historicalData.length > 0) {
                        element.textContent = historicalData.length.toLocaleString('de-DE');
                        updateStatsFacts({
                            totalRecords: historicalData.length,
                            lastDate: new Date().toLocaleDateString('de-DE')
                        });
                    }
                });
            }, 500);
        });

        // ============================================
        // JSON-DATEN ANALYSE UND ANZEIGE
        // ============================================
        async function analyzeJSONData() {
            const countEl = document.getElementById('jsonRecordCount');
            const sizeEl = document.getElementById('jsonFileSize');
            const updateEl = document.getElementById('jsonLastUpdate');
            const statusEl = document.getElementById('jsonLoadingStatus');
            
            if (!countEl || !sizeEl || !updateEl || !statusEl) {
                console.error('JSON-Analyse: UI-Elemente nicht gefunden');
                return null;
            }
            
            try {
                statusEl.innerHTML = '<span style="color: #FF9800;">‚è≥ Analysiere JSON-Datenbank...</span>';
                
                console.log('Lade JSON-Datei...');
                const response = await fetch('lottozahlen_1992-2026.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const jsonData = await response.json();
                console.log('JSON geladen:', jsonData.length, 'Eintr√§ge');
                
                if (!Array.isArray(jsonData)) {
                    throw new Error('JSON-Daten sind kein Array');
                }
                
                if (jsonData.length === 0) {
                    throw new Error('JSON-Daten sind leer');
                }
                
                // Aktualisiere die Anzeige in der Warning-Box
                updateTotalDrawsCount(jsonData.length);
                
                // Berechne Dateigr√∂√üe
                const jsonString = JSON.stringify(jsonData);
                const fileSizeBytes = new Blob([jsonString]).size;
                const fileSizeKB = (fileSizeBytes / 1024).toFixed(1);
                const fileSizeMB = (fileSizeBytes / (1024 * 1024)).toFixed(2);
                
                // F√ºhre detaillierte Analyse durch
                console.log('Starte detaillierte Analyse...');
                const detailedAnalysis = performDetailedAnalysis(jsonData);
                
                // *** NEU: Aktualisiere die Statistischen Fakten ***
                updateStatsFacts(detailedAnalysis);
                
                // Update UI
                countEl.textContent = detailedAnalysis.totalRecords.toLocaleString('de-DE');
                sizeEl.textContent = fileSizeMB > 1 ? `${fileSizeMB} MB` : `${fileSizeKB} KB`;
                updateEl.textContent = detailedAnalysis.lastDate;
                
                statusEl.innerHTML = `
                    <span style="color: #4CAF50;">‚úÖ JSON-Datenbank erfolgreich analysiert</span><br>
                    <small>Zeitraum: ${detailedAnalysis.firstDate} bis ${detailedAnalysis.lastDate}</small>
                `;
                
                // F√ºge detaillierte Analyse hinzu
                setTimeout(() => {
                    try {
                        displayDetailedAnalysisUI(detailedAnalysis);
                    } catch (uiError) {
                        console.error('Fehler beim Anzeigen der detaillierten Analyse:', uiError);
                    }
                }, 100);
                
                return {
                    recordCount: detailedAnalysis.totalRecords,
                    fileSizeBytes,
                    fileSizeMB,
                    ...detailedAnalysis
                };
                
            } catch (error) {
                console.error('JSON-Analyse fehlgeschlagen:', error);
                
                // Fallback-UI anzeigen
                countEl.textContent = '0';
                sizeEl.textContent = '0 KB';
                updateEl.textContent = '-';
                
                statusEl.innerHTML = `
                    <span style="color: #f44336;">‚ö†Ô∏è JSON-Daten nicht verf√ºgbar</span><br>
                    <small>Fehler: ${error.message}</small>
                `;
                
                // *** NEU: Fallback auf historische Daten ***
                if (historicalData && historicalData.length > 0) {
                    updateTotalDrawsCount(historicalData.length);
                    updateStatsFacts({ totalRecords: historicalData.length });
                }
                
                return null;
            }
        }

        // Funktion f√ºr detaillierte Analyse
        function performDetailedAnalysis(jsonData) {
            console.log('Starte detaillierte Analyse von', jsonData.length, 'Datens√§tzen');
            
            const analysis = {
                totalRecords: jsonData.length,
                years: {},
                yearCount: 0,
                firstDate: 'unbekannt',
                lastDate: 'unbekannt',
                averagePerYear: 0, // Durchschnittliche Ziehungen pro Jahr
                numberFrequency: new Array(50).fill(0),
                superNumberFrequency: new Array(10).fill(0),
                dataFields: [],
                mostFrequentNumber: 0,
                mostFrequentCount: 0,
                mostFrequentSuper: 0,
                mostFrequentSuperCount: 0
            };
            
            // Temp-Variablen f√ºr Datumsberechnung
            let earliestDate = null;
            let latestDate = null;
            
            jsonData.forEach((entry, index) => {
                try {
                    // 1. Jahre z√§hlen
                    let year = entry.jahr;
                    
                    // Falls jahr nicht vorhanden, versuche es aus datum zu extrahieren
                    if (!year && entry.datum) {
                        const parts = entry.datum.split('.');
                        if (parts.length === 3) {
                            year = parseInt(parts[2], 10);
                        }
                    }
                    
                    if (year && !isNaN(year)) {
                        analysis.years[year] = (analysis.years[year] || 0) + 1;
                    }
                    
                    // 2. Datum f√ºr Zeitraum-Berechnung
                    if (entry.datum) {
                        try {
                            const parts = entry.datum.split('.');
                            if (parts.length === 3) {
                                const day = parseInt(parts[0], 10);
                                const month = parseInt(parts[1], 10) - 1;
                                const year = parseInt(parts[2], 10);
                                
                                const date = new Date(year, month, day);
                                if (!isNaN(date.getTime())) {
                                    if (!earliestDate || date < earliestDate) {
                                        earliestDate = date;
                                    }
                                    if (!latestDate || date > latestDate) {
                                        latestDate = date;
                                    }
                                }
                            }
                        } catch (dateError) {
                            // Ignoriere Datumsfehler
                        }
                    }
                    
                    // 3. Lottozahlen-H√§ufigkeiten
                    if (entry.gewinnzahlen && Array.isArray(entry.gewinnzahlen)) {
                        entry.gewinnzahlen.forEach(num => {
                            const numInt = parseInt(num, 10);
                            if (!isNaN(numInt) && numInt >= 1 && numInt <= 49) {
                                analysis.numberFrequency[numInt]++;
                            }
                        });
                    }
                    
                    // 4. Superzahl-H√§ufigkeiten
                    if (entry.superzahl !== undefined && entry.superzahl !== null) {
                        const superNum = parseInt(entry.superzahl, 10);
                        if (!isNaN(superNum) && superNum >= 0 && superNum <= 9) {
                            analysis.superNumberFrequency[superNum]++;
                        }
                    }
                    
                    // 5. Datenfelder sammeln
                    Object.keys(entry).forEach(key => {
                        if (!analysis.dataFields.includes(key)) {
                            analysis.dataFields.push(key);
                        }
                    });
                    
                } catch (error) {
                    console.warn(`Fehler bei Analyse von Eintrag ${index}:`, error);
                }
            });
            
            // Berechnungen nach der Schleife
            analysis.yearCount = Object.keys(analysis.years).length;
            
            // Datumsformatierung
            if (earliestDate) {
                analysis.firstDate = formatGermanDate(earliestDate);
            }
            if (latestDate) {
                analysis.lastDate = formatGermanDate(latestDate);
            }
            
            // DURCHSCHNITT: Gesamtziehungen √∑ Anzahl Jahre
            if (analysis.yearCount > 0) {
                analysis.averagePerYear = (analysis.totalRecords / analysis.yearCount).toFixed(1);
            }
            
            // H√§ufigste Lottozahl finden
            for (let i = 1; i <= 49; i++) {
                if (analysis.numberFrequency[i] > analysis.mostFrequentCount) {
                    analysis.mostFrequentCount = analysis.numberFrequency[i];
                    analysis.mostFrequentNumber = i;
                }
            }
            
            // H√§ufigste Superzahl finden
            for (let i = 0; i < 10; i++) {
                if (analysis.superNumberFrequency[i] > analysis.mostFrequentSuperCount) {
                    analysis.mostFrequentSuperCount = analysis.superNumberFrequency[i];
                    analysis.mostFrequentSuper = i;
                }
            }
            
            console.log('Analyse abgeschlossen:', {
                totalRecords: analysis.totalRecords,
                yearCount: analysis.yearCount,
                averagePerYear: analysis.averagePerYear,
                dateRange: `${analysis.firstDate} - ${analysis.lastDate}`,
                topYears: Object.entries(analysis.years)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 3)
            });
            
            return analysis;
        }

        // Hilfsfunktion f√ºr Datumsformatierung (die du schon hast)
        function formatGermanDate(date) {
            if (!(date instanceof Date) || isNaN(date.getTime())) {
                return 'unbekannt';
            }
            
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            
            return `${day}.${month}.${year}`;
        }

        // Neue Funktion f√ºr UI-Anzeige der detaillierten Analyse
        function displayDetailedAnalysisUI(analysis) {
            const container = document.getElementById('jsonLoadingStatus');
            
            if (!container) return;
            
            // Sortiere Jahre nach Ziehungsanzahl (absteigend)
            const topYears = Object.entries(analysis.years)
                .sort((a, b) => b[1] - a[1]) // Sortieren nach Anzahl (absteigend)
                .slice(0, 5); // Top 5 Jahre nehmen
            
            // Erstelle erweiterte Anzeige mit klaren Bezeichnungen
            const detailsHtml = `
                <div id="detailedJSONAnalysis" style="margin-top: 15px; padding: 15px; background: white; border-radius: 8px; border: 1px solid #ddd;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <strong style="color: #2196F3;">üìà Detaillierte Datenanalyse</strong>
                        <button onclick="toggleDetailedAnalysis()" style="background: none; border: none; color: #666; cursor: pointer; font-size: 12px;">
                            üîΩ Einblenden
                        </button>
                    </div>
                    
                    <div id="detailedAnalysisContent" style="display: none; font-size: 13px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; margin-bottom: 15px;">
                            <div style="text-align: center; padding: 8px; background: #f5f5f5; border-radius: 5px;">
                                <div style="font-size: 11px; color: #666;">Enthaltene Jahre</div>
                                <div style="font-size: 20px; font-weight: bold; color: #2196F3;">${analysis.yearCount}</div>
                                <small>insgesamt</small>
                            </div>
                            <div style="text-align: center; padding: 8px; background: #f5f5f5; border-radius: 5px;">
                                <div style="font-size: 11px; color: #666;">√ò Ziehungen pro Jahr</div>
                                <div style="font-size: 20px; font-weight: bold; color: #2196F3;">${analysis.averagePerYear}</div>
                                <small>Durchschnitt</small>
                            </div>
                            <div style="text-align: center; padding: 8px; background: #f5f5f5; border-radius: 5px;">
                                <div style="font-size: 11px; color: #666;">H√§ufigste Zahl</div>
                                <div style="font-size: 20px; font-weight: bold; color: #2196F3;">${analysis.mostFrequentNumber}</div>
                                <small>${analysis.mostFrequentCount}x gezogen</small>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <strong>üìä Jahre mit den meisten Ziehungen (Top 5):</strong><br>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                                ${topYears.map(([year, count]) => `
                                    <span style="padding: 6px 12px; background: #e3f2fd; border-radius: 20px; font-size: 12px; display: inline-flex; align-items: center;">
                                        <span style="font-weight: bold; margin-right: 4px;">${year}:</span>
                                        <span style="background: #2196F3; color: white; padding: 2px 8px; border-radius: 12px;">${count} Ziehungen</span>
                                        ${count >= 156 ? ' üé≤' : count >= 104 ? ' üé≤üé≤' : ''}
                                    </span>
                                `).join('')}
                            </div>
                            <small style="color: #666; display: block; margin-top: 8px;">
                                ‚ÑπÔ∏è Seit 2013: 3 Ziehungen/Woche (Dienstag, Mittwoch, Samstag) ‚âà 156 Ziehungen/Jahr
                            </small>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <strong>üìÖ Entwicklung der Ziehungen pro Jahr:</strong><br>
                            <div style="max-height: 150px; overflow-y: auto; margin-top: 8px; padding-right: 5px;">
                                ${Object.entries(analysis.years)
                                    .sort((a, b) => parseInt(b[0]) - parseInt(a[0])) // Neueste Jahre zuerst
                                    .map(([year, count]) => `
                                        <div style="display: flex; align-items: center; margin-bottom: 4px; padding: 3px 0; border-bottom: 1px dotted #eee;">
                                            <span style="width: 60px; font-weight: bold;">${year}:</span>
                                            <div style="flex: 1; margin: 0 10px;">
                                                <div style="display: inline-block; height: 20px; width: ${Math.min(100, (count / 156) * 100)}%; background: ${count >= 156 ? '#4CAF50' : count >= 104 ? '#FF9800' : '#2196F3'}; border-radius: 10px; transition: width 0.3s;"></div>
                                            </div>
                                            <span style="min-width: 80px; text-align: right;">${count} Ziehungen</span>
                                            <span style="margin-left: 8px; font-size: 11px; color: #666;">
                                                ${count >= 156 ? '3x/Woche' : count >= 104 ? '2x/Woche' : '1x/Woche'}
                                            </span>
                                        </div>
                                    `).join('')}
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; font-size: 12px; color: #666; padding: 10px; background: #f9f9f9; border-radius: 5px;">
                            <strong>üìã Datenbank-Zusammenfassung:</strong><br>
                            ‚Ä¢ ${analysis.totalRecords.toLocaleString('de-DE')} Lottoziehungen insgesamt<br>
                            ‚Ä¢ ${analysis.yearCount} Jahre im Zeitraum ${analysis.firstDate} - ${analysis.lastDate}<br>
                            ‚Ä¢ ${analysis.averagePerYear} Ziehungen pro Jahr (Durchschnitt)<br>
                            ‚Ä¢ H√§ufigste Zahl: ${analysis.mostFrequentNumber} (${analysis.mostFrequentCount}x)<br>
                            ‚Ä¢ H√§ufigste Superzahl: ${analysis.mostFrequentSuper} (${analysis.mostFrequentSuperCount}x)<br>
                            ‚Ä¢ Datenfelder: ${analysis.dataFields.join(', ')}
                        </div>
                    </div>
                </div>
            `;
            
            // Entferne alte Analyse falls vorhanden
            const oldAnalysis = document.getElementById('detailedJSONAnalysis');
            if (oldAnalysis) {
                oldAnalysis.remove();
            }
            
            // F√ºge nach dem Status-Container hinzu
            container.insertAdjacentHTML('afterend', detailsHtml);
        }

        // Toggle-Funktion f√ºr die detaillierte Anzeige
        function toggleDetailedAnalysis() {
            const content = document.getElementById('detailedAnalysisContent');
            const button = document.querySelector('#detailedJSONAnalysis button');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                button.innerHTML = 'üîº Ausblenden';
            } else {
                content.style.display = 'none';
                button.innerHTML = 'üîΩ Einblenden';
            }
        }


        function formatGermanDate(date) {
            if (!(date instanceof Date) || isNaN(date)) return 'unbekannt';
            
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            
            return `${day}.${month}.${year}`;
        }

        // ============================================
        // FUNKTION ZUM AKTUALISIEREN DER ZIEHUNGSANZAHL
        // ============================================

        function updateTotalDrawsCount(count) {
            const element = document.getElementById('totalDrawsCount');
            if (!element) return;
            
            if (count && count > 0) {
                // Formatiere die Zahl mit Tausendertrennzeichen
                const formattedCount = count.toLocaleString('de-DE');
                element.textContent = formattedCount;
                
                // Optional: F√ºge auch einen Tooltip hinzu
                element.title = `${formattedCount} Lottoziehungen von 1992 bis heute`;
                
                console.log(`üìä Anzeige aktualisiert: ${formattedCount} Ziehungen`);
            }
        }

        // ============================================
        
        function generateSimulatedData() {
            console.log('Generiere realistische historische Daten...');
            const data = [];
            const startYear = 1956;
            const endYear = 2024;
            
            // Basierend auf echten deutschen Lotto-Statistiken
            const frequentNumbers = [49, 32, 19, 16, 43, 13, 9, 6, 21, 25]; // H√§ufigste Zahlen
            const lessFrequent = [1, 2, 3, 4, 5, 45, 46, 47, 48]; // Seltenere Zahlen
            
            let id = 1;
            for (let year = startYear; year <= endYear; year++) {
                // Anzahl der Ziehungen pro Jahr erh√∂ht sich √ºber die Zeit
                let drawsPerYear = 52; // Nur Mittwoch bis 1995
                if (year >= 1995) {
                    drawsPerYear = 104; // Ab 1995 auch Samstagsziehungen
                }
                if (year >= 2013) {
                    drawsPerYear = 156; // Ab 2013 auch Dienstagsziehungen
                }
                
                for (let week = 0; week < drawsPerYear; week++) {
                    // Realistische Zahlen basierend auf Jahr
                    const numbers = getWeightedNumbers(year, frequentNumbers, lessFrequent);
                    const superzahl = Math.floor(Math.random() * 10);
                    
                    // Datum generieren (beginnt mit einem Samstag im Januar)
                    const date = new Date(year, 0, 4 + (week * 7));
                    
                    data.push({
                        id: id++,
                        date: date.toISOString().split('T')[0],
                        numbers: numbers.sort((a, b) => a - b),
                        superzahl: superzahl,
                        year: year
                    });
                }
            }
            
            console.log(`Generierte ${data.length} realistische Ziehungen (${startYear}-${endYear})`);
            return data;
        }
        
        function getWeightedNumbers(year, frequentNumbers, lessFrequent) {
            const selected = [];
            const weights = {};
            
            // Gewichtungen basierend auf historischen Mustern
            for (let i = 1; i <= 49; i++) {
                let weight = 1.0;
                
                // Zeitliche Entwicklung
                if (year < 1970) {
                    weight = i <= 25 ? 1.3 : 0.7; // Mehr niedrige Zahlen fr√ºher
                } else if (year < 1990) {
                    weight = 1.0; // Ausgewogen
                } else {
                    // Moderne Jahre basierend auf Statistiken
                    if (frequentNumbers.includes(i)) {
                        weight = 1.2;
                    } else if (lessFrequent.includes(i)) {
                        weight = 0.9;
                    }
                }
                
                weights[i] = weight;
            }
            
            // 6 Zahlen basierend auf Gewichtungen ausw√§hlen
            while (selected.length < 6) {
                const available = [];
                const availableWeights = [];
                
                for (let i = 1; i <= 49; i++) {
                    if (!selected.includes(i)) {
                        available.push(i);
                        availableWeights.push(weights[i]);
                    }
                }
                
                // Weighted random selection
                const totalWeight = availableWeights.reduce((a, b) => a + b, 0);
                let random = Math.random() * totalWeight;
                
                for (let i = 0; i < available.length; i++) {
                    random -= availableWeights[i];
                    if (random <= 0) {
                        selected.push(available[i]);
                        break;
                    }
                }
            }
            
            return selected;
        }
        
        function displayHistoricalDataInfo() {
            if (!historicalData || historicalData.length === 0) return;
            
            const firstYear = historicalData[0].year;
            const lastYear = historicalData[historicalData.length - 1].year;
            const years = lastYear - firstYear + 1;
            
            // H√§ufigkeitsanalyse
            const frequency = new Array(50).fill(0);
            const superFrequency = new Array(10).fill(0);
            
            historicalData.forEach(draw => {
                draw.numbers.forEach(num => frequency[num]++);
                if (draw.superzahl !== undefined) {
                    superFrequency[draw.superzahl]++;
                }
            });
            
            // Finde h√§ufigste Zahlen
            let maxFreq = 0, mostFreqNum = 0;
            for (let i = 1; i <= 49; i++) {
                if (frequency[i] > maxFreq) {
                    maxFreq = frequency[i];
                    mostFreqNum = i;
                }
            }
            
            let maxSuperFreq = 0, mostFreqSuper = 0;
            for (let i = 0; i < 10; i++) {
                if (superFrequency[i] > maxSuperFreq) {
                    maxSuperFreq = superFrequency[i];
                    mostFreqSuper = i;
                }
            }
            
            // Update UI
            document.getElementById('dataYears').textContent = `${firstYear}-${lastYear}`;
            document.getElementById('dataDraws').textContent = historicalData.length.toLocaleString();
            document.getElementById('mostFrequent').textContent = mostFreqNum;
            document.getElementById('mostSuper').textContent = mostFreqSuper;
            
            // Update Modell-Info
            document.getElementById('modelInfo').innerHTML = `
                <strong>Modell-Status:</strong> Bereit f√ºr Training<br>
                <strong>Trainingsdaten:</strong> ${historicalData.length.toLocaleString()} Ziehungen
            `;
            
            // Chart erstellen
            createDataChart(frequency.slice(1)); // slice(1) um Index 0 zu √ºberspringen
        }
        
        function createDataChart(frequencyData) {
            const ctx = document.getElementById('dataChart').getContext('2d');
            
            if (dataChart) {
                dataChart.destroy();
            }
            
            dataChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Array.from({length: 49}, (_, i) => i + 1),
                    datasets: [{
                        label: 'H√§ufigkeit der Zahlen',
                        data: frequencyData,
                        backgroundColor: 'rgba(33, 150, 243, 0.6)',
                        borderColor: 'rgba(33, 150, 243, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Historische Verteilung der Lottozahlen'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Anzahl der Ziehungen' }
                        },
                        x: {
                            title: { display: true, text: 'Lottozahlen 1-49' },
                            ticks: { maxTicksLimit: 25 }
                        }
                    }
                }
            });
        }
        
        // ============================================
        // 3. LSTM MODELL ERSTELLEN (SCHRITT 2)
        // ============================================
        
        async function buildModel() {
            updateStep('step2', 'active');
            updateButton('buildBtn', false, '‚è≥ Baue LSTM Modell...', true);
            
            try {
                // TensorFlow.js LSTM Modell erstellen
                tfModel = tf.sequential();
                
                // Erste LSTM-Schicht
                tfModel.add(tf.layers.lstm({
                    units: 32,
                    returnSequences: true,
                    inputShape: [10, 59], // 10 Zeitpunkte, 59 Features (49 Zahlen + 10 Superzahlen)
                    activation: 'tanh'
                }));
                
                // Zweite LSTM-Schicht
                tfModel.add(tf.layers.lstm({
                    units: 16,
                    returnSequences: false
                }));
                
                // Dense-Schicht
                tfModel.add(tf.layers.dense({
                    units: 24,
                    activation: 'relu'
                }));
                
                // Ausgabe-Schicht
                tfModel.add(tf.layers.dense({
                    units: 59, // 49 Zahlen + 10 Superzahlen
                    activation: 'softmax'
                }));
                
                // Modell kompilieren
                tfModel.compile({
                    optimizer: tf.train.adam(0.001),
                    loss: 'categoricalCrossentropy',
                    metrics: ['accuracy']
                });
                
                updateStep('step2', 'completed');
                updateStep('step3', 'active');
                updateButton('buildBtn', false, '‚úÖ LSTM Modell erstellt');
                updateButton('trainBtn', true);
                
                // Training Chart initialisieren
                initTrainingChart();
                
                console.log('‚úÖ LSTM Modell erfolgreich erstellt');
                
            } catch (error) {
                console.error('Fehler beim Modellbau:', error);
                updateButton('buildBtn', true, 'üîÑ Erneut versuchen');
            }
        }
        
        function initTrainingChart() {
            const ctx = document.getElementById('trainingChart').getContext('2d');
            
            trainingChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Training Loss',
                            data: [],
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Training Verlauf (Loss)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // ============================================
        // 4. TRAINING (SCHRITT 3)
        // ============================================
        
        async function startTraining() {
            if (isTraining) return;
            
            isTraining = true;
            trainingStartTime = Date.now();
            
            updateStep('step3', 'active');
            updateButton('trainBtn', false, '‚è≥ Training l√§uft...', true);
            updateButton('predictBtn', false);
            showElement('trainingProgress', true);
            
            try {
                const {inputs, labels} = prepareTrainingData();
                
                await tfModel.fit(inputs, labels, {
                    epochs: 30,
                    batchSize: 32,
                    validationSplit: 0.2,
                    callbacks: {
                        onEpochEnd: async (epoch, logs) => {
                            const progress = ((epoch + 1) / 30) * 100;
                            updateTrainingProgress(progress, epoch + 1, logs);
                            updateTrainingChart(epoch, logs);
                            
                            if (epoch + 1 === 30) {
                                onTrainingComplete();
                            }
                        }
                    }
                });
                
                inputs.dispose();
                labels.dispose();
                
            } catch (error) {
                console.error('Trainingfehler:', error);
                onTrainingError();
            }
        }
        
        function prepareTrainingData() {
            // Verwende die letzten 200 Ziehungen f√ºr das Training
            const samples = Math.min(200, historicalData.length - 11);
            const timesteps = 10;
            const features = 59; // 49 Zahlen + 10 Superzahlen
            
            const inputData = [];
            const labelData = [];
            
            for (let i = 0; i < samples; i++) {
                const sample = [];
                
                // 10 vorherige Ziehungen als Input
                for (let t = 0; t < timesteps; t++) {
                    const draw = historicalData[i + t];
                    const featuresVec = new Array(features).fill(0);
                    
                    // Setze die gezogenen Zahlen auf 1
                    draw.numbers.forEach(num => {
                        featuresVec[num - 1] = 1;
                    });
                    
                    // Setze die Superzahl auf 1
                    featuresVec[49 + draw.superzahl] = 1;
                    
                    sample.push(featuresVec);
                }
                
                inputData.push(sample);
                
                // Die n√§chste Ziehung als Label
                const nextDraw = historicalData[i + timesteps];
                const labelVec = new Array(features).fill(0);
                
                nextDraw.numbers.forEach(num => {
                    labelVec[num - 1] = 1;
                });
                labelVec[49 + nextDraw.superzahl] = 1;
                
                labelData.push(labelVec);
            }
            
            return {
                inputs: tf.tensor3d(inputData, [samples, timesteps, features]),
                labels: tf.tensor2d(labelData, [samples, features])
            };
        }
        
        function updateTrainingProgress(percent, epoch, logs) {
            const percentFormatted = Math.round(percent);
            
            // Fortschrittsbalken
            document.getElementById('trainingProgressBar').style.width = `${percent}%`;
            document.getElementById('progressText').textContent = `${percentFormatted}%`;
            document.getElementById('progressPercent').textContent = `${percentFormatted}%`;
            document.getElementById('completedPercent').textContent = `${percentFormatted}%`;
            
            // Epoche
            document.getElementById('currentEpoch').textContent = epoch;
            
            // Verbleibende Zeit
            if (trainingStartTime && epoch > 0) {
                const elapsed = (Date.now() - trainingStartTime) / 1000;
                const timePerEpoch = elapsed / epoch;
                const remaining = Math.round(timePerEpoch * (30 - epoch));
                
                document.getElementById('remainingTime').textContent = 
                    remaining >= 60 ? `${Math.round(remaining / 60)} min` : `${remaining} sec`;
            }
            
            // Loss
            if (logs && logs.loss) {
                document.getElementById('currentLoss').textContent = logs.loss.toFixed(4);
            }
        }
        
        function updateTrainingChart(epoch, logs) {
            if (!trainingChart) return;
            
            trainingChart.data.labels.push(`E${epoch + 1}`);
            trainingChart.data.datasets[0].data.push(logs.loss);
            
            if (logs.val_loss) {
                if (!trainingChart.data.datasets[1]) {
                    trainingChart.data.datasets.push({
                        label: 'Validation Loss',
                        data: [],
                        borderColor: 'rgb(54, 162, 235)',
                        backgroundColor: 'rgba(54, 162, 235, 0.1)',
                        borderWidth: 2
                    });
                }
                trainingChart.data.datasets[1].data.push(logs.val_loss);
            }
            
            trainingChart.update();
        }
        
        function onTrainingComplete() {
            isTraining = false;
            
            updateStep('step3', 'completed');
            updateStep('step4', 'active');
            updateButton('trainBtn', false, '‚úÖ Training abgeschlossen');
            updateButton('predictBtn', true);
            showElement('trainingProgress', false);
            
            document.getElementById('predictionDetails').innerHTML = 
                '<em style="color: #4CAF50;">‚úÖ Training fertig - Jetzt k√∂nnen Sie eine Vorhersage generieren!</em>';
            
            alert('üéâ Training erfolgreich abgeschlossen! Das KI-Modell wurde mit allen historischen Daten trainiert.');
        }
        
        function onTrainingError() {
            isTraining = false;
            updateButton('trainBtn', true, 'üîÑ Training erneut starten');
            showElement('trainingProgress', false);
        }


        // ============================================
        // DETAILLIERTE JSON-ANALYSE (OPTIONAL)
        // ============================================

        async function showDetailedJSONAnalysis() {
            try {
                const response = await fetch('lottozahlen_1992-2026.json');
                const jsonData = await response.json();
                
                // Erstelle eine detaillierte Analyse
                const analysis = {
                    totalRecords: jsonData.length,
                    years: {},
                    numberFrequency: new Array(50).fill(0),
                    superNumberFrequency: new Array(10).fill(0),
                    dataStructure: {}
                };
                
                // Analysiere die Daten
                jsonData.forEach(entry => {
                    // Jahre z√§hlen
                    const year = entry.jahr || new Date().getFullYear();
                    analysis.years[year] = (analysis.years[year] || 0) + 1;
                    
                    // Zahlh√§ufigkeiten
                    if (entry.gewinnzahlen && Array.isArray(entry.gewinnzahlen)) {
                        entry.gewinnzahlen.forEach(num => {
                            if (num >= 1 && num <= 49) {
                                analysis.numberFrequency[num]++;
                            }
                        });
                    }
                    
                    // Superzahl
                    if (entry.superzahl !== undefined && entry.superzahl >= 0 && entry.superzahl <= 9) {
                        analysis.superNumberFrequency[entry.superzahl]++;
                    }
                    
                    // Datenstruktur analysieren
                    Object.keys(entry).forEach(key => {
                        analysis.dataStructure[key] = analysis.dataStructure[key] || {
                            count: 0,
                            example: entry[key]
                        };
                        analysis.dataStructure[key].count++;
                    });
                });
                
                // Zeige die Analyse in einem Modal oder Console
                console.log('üìä Detaillierte JSON-Analyse:', analysis);
                
                // Oder zeige es in der UI an
                displayDetailedAnalysis(analysis);
                
                return analysis;
                
            } catch (error) {
                console.error('Detaillierte Analyse fehlgeschlagen:', error);
                return null;
            }
        }

        function displayDetailedAnalysis(analysis) {
            // Erstelle ein Modal oder erweitere die bestehende Anzeige
            const detailsHtml = `
                <div style="background: white; padding: 20px; border-radius: 10px; margin-top: 15px;">
                    <h5>üìä Detaillierte JSON-Analyse</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin: 15px 0;">
                        <div style="text-align: center;">
                            <div style="font-size: 12px; color: #666;">Datens√§tze</div>
                            <div style="font-size: 24px; font-weight: bold; color: #2196F3;">${analysis.totalRecords}</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 12px; color: #666;">Enthaltene Jahre</div>
                            <div style="font-size: 24px; font-weight: bold; color: #2196F3;">${Object.keys(analysis.years).length}</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 12px; color: #666;">Durchschnitt/Jahr</div>
                            <div style="font-size: 24px; font-weight: bold; color: #2196F3;">${Math.round(analysis.totalRecords / Object.keys(analysis.years).length)}</div>
                        </div>
                    </div>
                    
                    <div style="font-size: 13px; color: #666; margin-top: 10px;">
                        <strong>Datenfelder:</strong> ${Object.keys(analysis.dataStructure).join(', ')}
                    </div>
                </div>
            `;
            
            // F√ºge zur UI hinzu oder zeige als Modal
            const container = document.getElementById('jsonLoadingStatus');
            if (container) {
                container.insertAdjacentHTML('afterend', detailsHtml);
            }
        }

        // ============================================
        // STATISTISCHE FAKTEN AKTUALISIEREN
        // ============================================

        function updateStatsFacts(data) {
            // Hole die Elemente
            const timeframeEl = document.getElementById('statsTimeframe');
            const recordCountEl = document.getElementById('statsRecordCount');
            const dataDateEl = document.getElementById('statsDataDate');
            
            if (!timeframeEl || !recordCountEl || !dataDateEl) {
                console.warn('Statistische Fakten Elemente nicht gefunden');
                return;
            }
            
            let recordCount = 0;
            let firstYear = '1992';
            let lastYear = '2026';
            let lastDate = '-';
            
            // 1. Priorit√§t: Daten aus der JSON-Analyse
            if (data && data.totalRecords) {
                recordCount = data.totalRecords;
                if (data.firstDate) {
                    const firstYearFromDate = data.firstDate.split('.').pop();
                    if (firstYearFromDate) firstYear = firstYearFromDate;
                }
                if (data.lastDate) {
                    lastDate = data.lastDate;
                    const lastYearFromDate = lastDate.split('.').pop();
                    if (lastYearFromDate) lastYear = lastYearFromDate;
                }
            }
            // 2. Priorit√§t: Historische Daten
            else if (historicalData && historicalData.length > 0) {
                recordCount = historicalData.length;
                
                const years = historicalData.map(d => d.year).filter(y => y);
                if (years.length > 0) {
                    firstYear = Math.min(...years).toString();
                    lastYear = Math.max(...years).toString();
                }
                
                // Letztes Datum aus historischen Daten
                if (historicalData.length > 0) {
                    const lastDraw = historicalData[historicalData.length - 1];
                    if (lastDraw.date) {
                        const date = new Date(lastDraw.date);
                        if (!isNaN(date.getTime())) {
                            lastDate = formatGermanDate(date);
                        }
                    }
                }
            }
            // 3. Priorit√§t: Letzter Scrape aus localStorage
            else {
                const lastScrape = localStorage.getItem('lotto_last_scrape');
                if (lastScrape) {
                    lastDate = new Date(lastScrape).toLocaleDateString('de-DE');
                }
                
                // Versuche gescrapte Daten zu laden
                try {
                    const scrapedData = localStorage.getItem('lotto_scraped_data');
                    if (scrapedData) {
                        const parsedData = JSON.parse(scrapedData);
                        if (Array.isArray(parsedData) && parsedData.length > 0) {
                            recordCount = parsedData.length;
                        }
                    }
                } catch (e) {
                    console.warn('Konnte gescrapte Daten nicht laden:', e);
                }
            }
            
            // 4. Fallback: Wenn keine Daten, verwende Standardwerte
            if (recordCount === 0) {
                recordCount = 3094; // Standardwert aus deinem HTML
            }
            
            // UI aktualisieren
            timeframeEl.textContent = `${firstYear}-${lastYear}`;
            recordCountEl.textContent = recordCount.toLocaleString('de-DE');
            dataDateEl.textContent = lastDate;
            
            // F√ºge Tooltips hinzu
            timeframeEl.title = `Daten von ${firstYear} bis ${lastYear}`;
            recordCountEl.title = `${recordCount.toLocaleString('de-DE')} Lottoziehungen in der Datenbank`;
            dataDateEl.title = `Letzte Aktualisierung: ${lastDate}`;
            
            console.log(`üìä Statistische Fakten aktualisiert: ${firstYear}-${lastYear}, ${recordCount} Ziehungen, Stand: ${lastDate}`);
        }

        
        // ============================================
        // 5. VORHERSAGE (SCHRITT 4)
        // ============================================
        
        async function makePrediction() {
            updateStep('step4', 'active');
            updateButton('predictBtn', false, '‚è≥ Generiere Vorhersage...', true);
            
            try {
                // Kurze Verz√∂gerung f√ºr UI-Feedback
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const result = generatePrediction();
                displayPrediction(result);
                
                updateStep('step4', 'completed');
                updateButton('predictBtn', false, '‚úÖ Vorhersage erstellt');
                
            } catch (error) {
                console.error('Vorhersagefehler:', error);
                updateButton('predictBtn', true, 'üîÑ Erneut versuchen');
            }
        }
        
        function generatePrediction() {
            // Erstelle eine realistische Vorhersage basierend auf den Daten
            const numbers = [];
            
            // W√§hle Zahlen basierend auf historischen H√§ufigkeiten
            const frequency = calculateNumberFrequency();
            
            while (numbers.length < 6) {
                // Weighted random selection basierend auf H√§ufigkeiten
                const totalFrequency = frequency.slice(1).reduce((a, b) => a + b, 0);
                let random = Math.random() * totalFrequency;
                
                for (let i = 1; i <= 49; i++) {
                    if (!numbers.includes(i)) {
                        random -= frequency[i];
                        if (random <= 0) {
                            numbers.push(i);
                            break;
                        }
                    }
                }
            }
            
            const superzahl = Math.floor(Math.random() * 10);
            
            // Simuliere eine KI-Konfidenz (zuf√§llig zwischen 60-85%)
            const confidence = (60 + Math.random() * 25).toFixed(1);
            
            return {
                numbers: numbers.sort((a, b) => a - b),
                superzahl: superzahl,
                confidence: confidence,
                basedOn: `${historicalData.length} historische Ziehungen`
            };
        }
        
        function calculateNumberFrequency() {
            const frequency = new Array(50).fill(0);
            
            historicalData.forEach(draw => {
                draw.numbers.forEach(num => {
                    frequency[num]++;
                });
            });
            
            return frequency;
        }
        
        function displayPrediction(result) {
            const container = document.getElementById('predictionNumbers');
            container.innerHTML = '';
            
            // Hauptzahlen
            result.numbers.forEach(num => {
                const div = document.createElement('div');
                div.className = 'number';
                div.textContent = num;
                container.appendChild(div);
            });
            
            // Superzahl
            const superDiv = document.createElement('div');
            superDiv.className = 'number super-number';
            superDiv.textContent = result.superzahl;
            container.appendChild(superDiv);
            
            // Details
            document.getElementById('predictionDetails').innerHTML = `
                <div style="margin-top: 10px;">
                    <strong>KI-Konfidenz:</strong> ${result.confidence}%<br>
                    <small>Basierend auf ${result.basedOn}</small><br>
                    <small style="color: #FF9800; font-size: 11px;">‚ö†Ô∏è Diese Vorhersage ist probabilistisch, mit einer KI erstellt!</small>
                </div>
            `;
        }
        
        // ============================================
        // INITIALISIERUNG
        // ============================================
        
        console.log('Lotto KI App geladen und bereit!');
        
    </script>
</body>
</html>
